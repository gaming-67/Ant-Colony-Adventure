<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ant Colony Adventure</title>
<style>
body {margin:0; overflow:hidden; font-family:Arial; background:#222;}
canvas {display:block; margin:0 auto; background:#5b3922;}
#ui {position:absolute; top:10px; left:10px; color:white; z-index:10; font-size:14px;}
#updatesBtn {position:absolute; top:10px; right:10px; padding:5px 10px; background:#444; color:white; border:none; cursor:pointer; border-radius:5px;}
#updatesPanel {display:none; position:absolute; top:45px; right:10px; background:#333; color:white; padding:10px; border-radius:5px;}
#overlay {position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:white;font-size:32px;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">
  <div id="currentAnt"></div>
  <div id="colonyStats"></div>
  <div id="enemyStats"></div>
  <div>Controls: WASD = Move | SPACE = Attack</div>
</div>
<button id="updatesBtn">Updates</button>
<div id="updatesPanel">
  <h3>New Features</h3>
  <ul>
    <li>Health bars for ants & enemies</li>
    <li>Dynamic enemy spawning</li>
    <li>Queen lays eggs</li>
    <li>Expanded UI</li>
  </ul>
</div>
<div id="overlay">Press ENTER to Start</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let W=window.innerWidth,H=window.innerHeight;
canvas.width=W; canvas.height=H;

let keys={},gameState="menu";
let ants=[],enemies=[],foods=[],eggs=[],damageTexts=[];
let player,colonyFood=0,score=0,timer=0;

document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);
window.addEventListener("resize",()=>{W=window.innerWidth;H=window.innerHeight;canvas.width=W;canvas.height=H;});

document.getElementById("updatesBtn").onclick=()=>{
  let p=document.getElementById("updatesPanel");
  p.style.display=p.style.display==="none"?"block":"none";
};

// ===== CLASSES =====
class Food{
  constructor(x,y){this.x=x;this.y=y;this.size=6;this.collected=false;}
  draw(){
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

class Egg{
  constructor(x,y){this.x=x;this.y=y;this.timer=0;this.hatch=300;}
  update(){
    this.timer++;
    if(this.timer>=this.hatch){
      let t=Math.random()<0.5?"worker":"soldier";
      ants.push(new Ant(this.x+Math.random()*20-10,this.y+Math.random()*20-10,t));
      eggs.splice(eggs.indexOf(this),1);
    }
  }
  draw(){
    ctx.fillStyle="orange";
    ctx.beginPath();
    ctx.arc(this.x,this.y,5,0,Math.PI*2);
    ctx.fill();
  }
}

class Ant{
  constructor(x,y,type){
    this.x=x;this.y=y;this.type=type;
    this.size=type==="queen"?14:8;
    this.color=type==="queen"?"purple":(type==="soldier"?"blue":"brown");
    this.speed=type==="scout"?3:1.5;
    this.health=type==="soldier"?5:3;
    this.maxHealth=this.health;
  }
  move(){
    if(this===player){
      if(keys["w"]) this.y-=this.speed;
      if(keys["s"]) this.y+=this.speed;
      if(keys["a"]) this.x-=this.speed;
      if(keys["d"]) this.x+=this.speed;
    }
  }
  attack(){
    for(let e of enemies){
      let dx=e.x-this.x,dy=e.y-this.y;
      if(Math.hypot(dx,dy)<20){
        e.health--;
        damageTexts.push({x:e.x,y:e.y,val:1,time:0});
        if(e.health<=0) enemies.splice(enemies.indexOf(e),1);
      }
    }
  }
  draw(){
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();

    // health bar
    let barW=this.size*2;
    ctx.fillStyle="red";
    ctx.fillRect(this.x-this.size,this.y-this.size-6,barW*(this.health/this.maxHealth),3);
    ctx.strokeStyle="black";
    ctx.strokeRect(this.x-this.size,this.y-this.size-6,barW,3);
  }
}

class Enemy{
  constructor(x,y,type){
    this.x=x;this.y=y;this.type=type;
    this.size=10;
    this.color=type==="spider"?"darkred":"green";
    this.health=type==="beetle"?4:2;
    this.maxHealth=this.health;
    this.speed=type==="beetle"?0.6:1.2;
  }
  update(){
    if(ants.length===0) return;
    let t=ants[0];
    let dx=t.x-this.x,dy=t.y-this.y;
    let d=Math.hypot(dx,dy);
    if(d>1){this.x+=dx/d*this.speed;this.y+=dy/d*this.speed;}
    if(d<15){
      t.health--;
      damageTexts.push({x:t.x,y:t.y,val:1,time:0});
      if(t.health<=0) ants.splice(ants.indexOf(t),1);
    }
  }
  draw(){
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
    // health bar
    ctx.fillStyle="red";
    ctx.fillRect(this.x-this.size,this.y-this.size-5,this.size*2*(this.health/this.maxHealth),3);
    ctx.strokeStyle="black";
    ctx.strokeRect(this.x-this.size,this.y-this.size-5,this.size*2,3);
  }
}

// ===== GAME =====
function spawnEnemy(){
  let types=["spider","beetle"];
  let type=types[Math.floor(Math.random()*types.length)];
  enemies.push(new Enemy(Math.random()*W,Math.random()*H,type));
}

function spawnFood(){
  foods.push(new Food(Math.random()*W,Math.random()*H));
}

function init(){
  ants=[];enemies=[];foods=[];eggs=[];damageTexts=[];
  let queen=new Ant(W/2,H/2,"queen");
  ants.push(queen);
  player=new Ant(W/2+40,H/2,"worker");
  ants.push(player);
  for(let i=0;i<10;i++) spawnFood();
  colonyFood=0; score=0; timer=0;
  gameState="play";
  document.getElementById("overlay").style.display="none";
}

document.addEventListener("keydown",e=>{
  if(e.key==="Enter" && gameState==="menu") init();
  if(e.key===" " && player) player.attack();
});

function updateUI(){
  let cAnt=`Active Ant: ${player.type} (${player.health}/${player.maxHealth})`;
  let colony=`Colony Food: ${colonyFood} | Ants: ${ants.length} | Eggs: ${eggs.length}`;
  let enemy=`Enemies: ${enemies.length}`;
  document.getElementById("currentAnt").innerText=cAnt;
  document.getElementById("colonyStats").innerText=colony;
  document.getElementById("enemyStats").innerText=enemy;
}

function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,W,H);
  if(gameState==="menu") return;
  timer++;

  // Spawning
  if(timer%200===0) spawnFood();
  if(timer%120===0) spawnEnemy();
  if(timer%600===0) eggs.push(new Egg(W/2,H/2));

  // Update
  for(let e of enemies) e.update();
  for(let a of ants) a.move();
  for(let egg of eggs) egg.update();

  // Draw
  for(let f of foods) f.draw();
  for(let egg of eggs) egg.draw();
  for(let a of ants) a.draw();
  for(let e of enemies) e.draw();

  damageTexts.forEach(d=>{
    ctx.fillStyle="yellow";
    ctx.font="14px Arial";
    ctx.fillText("-"+d.val,d.x,d.y);
    d.y-=0.5; d.time++;
  });
  damageTexts=damageTexts.filter(d=>d.time<40);

  updateUI();
}
loop();
</script>
</body>
</html>
